<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGP - Sistema de Generaci√≥n Proyectada</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.28.5/docxtemplater.js"></script>
    <script src="https://unpkg.com/pizzip@3.1.1/dist/pizzip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --primary: #2563eb;
            --success: #22c55e; --border: #e2e8f0; --label: #475569;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --primary: #3b82f6;
                --success: #10b981; --border: #334155; --label: #94a3b8;
            }
        }

        * { box-sizing: border-box; transition: background 0.3s, color 0.3s; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; }

        .app-container { width: 100%; max-width: 850px; background: var(--card); padding: 40px; border-radius: 20px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        
        h1 { font-size: 1.75rem; font-weight: 700; color: var(--primary); text-align: center; margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        
        label { display: block; font-size: 0.9rem; font-weight: 600; color: var(--label); margin-bottom: 8px; }
        input, textarea { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border); background: var(--bg); color: var(--text); font-size: 1rem; }
        input:focus { outline: 2px solid var(--primary); border-color: transparent; }

        /* Estilo de Opciones */
        .option-box { background: rgba(148, 163, 184, 0.1); padding: 15px; border-radius: 12px; margin: 15px 0; display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .switch { position: relative; width: 44px; height: 22px; background: #94a3b8; border-radius: 20px; }
        .switch::after { content: ''; position: absolute; width: 18px; height: 18px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: 0.3s; }
        input:checked + .switch { background: var(--success); }
        input:checked + .switch::after { transform: translateX(22px); }

        .btn-main { width: 100%; background: var(--success); color: white; padding: 18px; border-radius: 12px; border: none; font-size: 1.1rem; font-weight: 700; cursor: pointer; margin-top: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .btn-main:hover { opacity: 0.9; transform: scale(1.01); }

        /* Modal de Resumen */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); z-index: 100; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: var(--card); width: 100%; max-width: 600px; padding: 30px; border-radius: 20px; max-height: 90vh; overflow-y: auto; }
        .resumen-item { margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
        .resumen-label { font-size: 0.8rem; color: var(--label); font-weight: 700; text-transform: uppercase; }
        .resumen-val { font-size: 1.1rem; font-weight: 500; }

        .modal-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
        .btn-edit { background: #64748b; color: white; padding: 12px; border-radius: 10px; border: none; cursor: pointer; }
        .btn-confirm { background: var(--primary); color: white; padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-weight: 700; }
    </style>
</head>
<body>

<div class="app-container">
    <h1>‚öñÔ∏è CEE LIBERTAD</h1>
    
    <form id="docForm">
        <div class="grid">
            <div>
                <label>DNI Imputado</label>
                <input type="text" id="dni" maxlength="8" placeholder="8 d√≠gitos">
            </div>
            <div>
                <label>Nombre Completo</label>
                <input type="text" id="nombre" placeholder="CARLOS PEREZ GOMEZ">
            </div>
        </div>

        <div class="grid" style="margin-top: 20px;">
            <div>
                <label>N¬∞ Disposici√≥n</label>
                <input type="text" id="num_disp" value="01-2026">
            </div>
            <div>
                <label>Fecha de los Hechos</label>
                <input type="text" id="fecha_hechos" placeholder="24 de febrero de 2026">
            </div>
        </div>

        <label class="option-box">
            <input type="checkbox" id="check_vehiculo" hidden onchange="document.getElementById('fields_vehiculo').style.display = this.checked ? 'grid' : 'none'">
            <div class="switch"></div>
            <strong>¬øIncluir Devoluci√≥n de Veh√≠culo?</strong>
        </label>

        <div id="fields_vehiculo" class="grid" style="display: none; background: rgba(148,163,184,0.05); padding: 15px; border-radius: 12px;">
            <div><label>Veh√≠culo</label><input type="text" id="vehiculo"></div>
            <div><label>Placa</label><input type="text" id="placa"></div>
        </div>

        <div style="margin-top: 20px;">
            <label>Resumen de Hechos</label>
            <textarea id="hechos" rows="3"></textarea>
        </div>

        <div class="grid" style="margin-top: 20px;">
            <div><label>Certificado Dosaje</label><input type="text" id="num_dosaje"></div>
            <div><label>Resultado (G/L)</label><input type="number" id="res_dosaje" value="0.47" step="0.01"></div>
        </div>

        <label class="option-box">
            <input type="checkbox" id="check_firma" hidden>
            <div class="switch"></div>
            <strong>¬øConsignar Firma Digital?</strong>
        </label>

        <button type="button" class="btn-main" onclick="abrirResumen()">üìÑ VER RESUMEN Y GENERAR</button>
    </form>
</div>

<div id="modalResumen" class="modal">
    <div class="modal-content">
        <h2 style="margin-top:0">üîç Revisi√≥n de Datos</h2>
        <div id="listaResumen"></div>
        <div class="modal-btns">
            <button class="btn-edit" onclick="cerrarResumen()">‚¨ÖÔ∏è CORREGIR</button>
            <button class="btn-confirm" onclick="procesarWord()">‚úÖ TODO CORRECTO</button>
        </div>
    </div>
</div>

<script>
    // Fecha autom√°tica de disposici√≥n
    const f = new Date();
    const meses = ["enero", "febrero", "marzo", "abril", "mayo", "junio", "julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"];
    const fechaActual = `Piura, ${f.getDate()} de ${meses[f.getMonth()]} de ${f.getFullYear()}`;

    function abrirResumen() {
        const nombre = document.getElementById('nombre').value;
        if (!nombre) return alert("Ingrese el nombre del imputado");

        const dataResumen = [
            { l: "Imputado", v: nombre.toUpperCase() },
            { l: "DNI", v: document.getElementById('dni').value },
            { l: "Disposici√≥n", v: document.getElementById('num_disp').value },
            { l: "Fecha Hechos", v: document.getElementById('fecha_hechos').value },
            { l: "Veh√≠culo", v: document.getElementById('check_vehiculo').checked ? document.getElementById('vehiculo').value : "NO APLICA" },
            { l: "Firma", v: document.getElementById('check_firma').checked ? "SI" : "NO" }
        ];

        let html = "";
        dataResumen.forEach(item => {
            html += `<div class="resumen-item"><div class="resumen-label">${item.l}</div><div class="resumen-val">${item.v || '---'}</div></div>`;
        });
        
        document.getElementById('listaResumen').innerHTML = html;
        document.getElementById('modalResumen').style.display = 'flex';
    }

    function cerrarResumen() { document.getElementById('modalResumen').style.display = 'none'; }

    function convertirDosajeALetras(num) {
        const valor = parseFloat(num);
        const partes = valor.toFixed(2).split('.');
        const unidades = ["cero", "un", "dos", "tres", "cuatro", "cinco", "seis", "siete", "ocho", "nueve"];
        return `${unidades[parseInt(partes[0])] || partes[0]} gramos con ${partes[1]} centigramos de alcohol por litro de sangre`;
    }

    async function procesarWord() {
        cerrarResumen();
        const conFirma = document.getElementById('check_firma').checked;
        const nombre = document.getElementById('nombre').value.toUpperCase().trim();
        const archivo = conFirma ? 'MODELO_3_FIRMADO.docx' : 'MODELO_3.docx';

        const data = {
            NUMERO_DISPOSICION: document.getElementById('num_disp').value,
            FECHA_DISPOSICION: fechaActual,
            NOMBRE_IMPUTADO: nombre,
            NUMERO_DNI: document.getElementById('dni').value,
            FECHA_DE_HECHOS: document.getElementById('fecha_hechos').value,
            HECHOS: document.getElementById('hechos').value,
            NUMER_DOSAJE: document.getElementById('num_dosaje').value,
            RESULTADO_DOSAJE: document.getElementById('res_dosaje').value + " G/L",
            RESULTADO_DOSAJE_LETRAS: convertirDosajeALetras(document.getElementById('res_dosaje').value),
            mostrar_vehiculo: document.getElementById('check_vehiculo').checked,
            VEHICULO: document.getElementById('vehiculo').value.toUpperCase(),
            PLACA: document.getElementById('placa').value.toUpperCase()
        };

        try {
            const resp = await fetch(archivo);
            const blob = await resp.arrayBuffer();
            const zip = new PizZip(blob);
            const doc = new window.docxtemplater(zip, { paragraphLoop: true, linebreaks: true });
            doc.render(data);
            const out = doc.getZip().generate({ type: "blob" });
            saveAs(out, `CCE LIBERTAD ${nombre}.docx`);
        } catch (e) {
            alert("Error al procesar archivos base.");
        }
    }
</script>
</body>
</html>
