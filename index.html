<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Disposiciones - Libertad</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.28.5/docxtemplater.js"></script>
    <script src="https://unpkg.com/pizzip@3.1.1/dist/pizzip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
    
    <style>
        body { max-width: 800px; margin: auto; padding: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full-width { grid-column: 1 / -1; }
        
        .caja-firma {
            background-color: #f0f4f8;
            border: 1px solid #d1d9e0;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .check-container {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            user-select: none;
        }

        input[type="checkbox"] {
            width: 22px;
            height: 22px;
            margin: 0;
            cursor: pointer;
        }

        button {
            width: 100%;
            background-color: #0056b3;
            color: white;
            padding: 15px;
            font-size: 1.1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover { background-color: #004494; }
        
        h1 { text-align: center; color: #0056b3; }
        hr { border: 0; border-top: 1px solid #ccc; margin: 20px 0; }
    </style>
</head>
<body>

    <h1> Generador de Disposiciones CEE LIBERTAD - PROYECTO OMAR</h1>
    <p style="text-align: center;">SOLO PARA FINES DE USO INTERNO Y DESAROLLO</p>
    <hr>

    <form id="docForm">
        <div class="grid">
            <div>
                <label for="num_disp">NÂ° DisposiciÃ³n</label>
                <input type="text" id="num_disp" value="01-2026" required>
                
                <label for="dni">DNI del Imputado</label>
                <input type="text" id="dni" maxlength="8" placeholder="Ingrese 8 dÃ­gitos" required>
                
                <label for="nombre">Nombre Completo</label>
                <input type="text" id="nombre" placeholder="Ej: JUAN PÃ‰REZ LÃ“PEZ" required>
            </div>
            <div>
                <label for="fecha_disp">Lugar y Fecha Hoy</label>
                <input type="text" id="fecha_disp" value="Piura, 24 de febrero de 2026" required>
                
                <label for="vehiculo">VehÃ­culo</label>
                <input type="text" id="vehiculo" placeholder="Ej: Motocicleta Honda" required>
                
                <label for="placa">NÂ° Placa</label>
                <input type="text" id="placa" placeholder="Ej: 1234-5B" required>
            </div>
        </div>

        <label for="hechos">Hechos Indagados</label>
        <textarea id="hechos" rows="4" placeholder="Describa brevemente la intervenciÃ³n..." required></textarea>

        <div class="grid">
            <label for="num_dosaje">NÂ° Certificado Dosaje</label>
            <input type="text" id="num_dosaje" placeholder="Ej: 0022-00123" required>
            
            <label for="res_dosaje">Resultado Dosaje (NÃºmero)</label>
            <input type="number" step="0.01" id="res_dosaje" value="0.47" required>
        </div>

        <div class="caja-firma">
            <label class="check-container">
                <input type="checkbox" id="check_firma">
                <span style="font-weight: bold; font-size: 1.1em;">Â¿Desea consignar firma en el documento?</span>
            </label>
        </div>

        <button type="button" onclick="generarDocumento()">ðŸš€ Descargar DisposiciÃ³n (.docx)</button>
    </form>

    <script>
        // FunciÃ³n para convertir el dosaje numÃ©rico a texto legal
        function convertirDosajeALetras(num) {
            const valor = parseFloat(num);
            if (isNaN(valor)) return "";
            const partes = valor.toFixed(2).split('.');
            const unidades = ["cero", "un", "dos", "tres", "cuatro", "cinco", "seis", "siete", "ocho", "nueve"];
            
            let textoEnteros = unidades[parseInt(partes[0])] || partes[0];
            return `${textoEnteros} gramos con ${partes[1]} centigramos de alcohol por litro de sangre`;
        }

        async function generarDocumento() {
            // 1. Verificar quÃ© modelo usar
            const conFirma = document.getElementById('check_firma').checked;
            const archivoModelo = conFirma ? 'MODELO_3_FIRMADO.docx' : 'MODELO_3.docx';

            // 2. Capturar datos del formulario
            const data = {
                NUMERO_DISPOSICION: document.getElementById('num_disp').value,
                FECHA_DISPOSICION: document.getElementById('fecha_disp').value,
                NOMBRE_IMPUTADO: document.getElementById('nombre').value.toUpperCase(),
                NUMERO_DNI: document.getElementById('dni').value,
                HECHOS: document.getElementById('hechos').value,
                NUMER_DOSAJE: document.getElementById('num_dosaje').value,
                RESULTADO_DOSAJE: document.getElementById('res_dosaje').value + " G/L",
                RESULTADO_DOSAJE_LETRAS: convertirDosajeALetras(document.getElementById('res_dosaje').value),
                VEHICULO: document.getElementById('vehiculo').value.toUpperCase(),
                PLACA: document.getElementById('placa').value.toUpperCase()
            };

            // ValidaciÃ³n simple
            if (!data.NUMERO_DNI || !data.NOMBRE_IMPUTADO) {
                alert("Por favor, complete los datos principales.");
                return;
            }

            try {
                // 3. Cargar el archivo .docx desde GitHub
                const response = await fetch(archivoModelo);
                if (!response.ok) throw new Error("No se encontrÃ³ el archivo: " + archivoModelo);
                
                const content = await response.arrayBuffer();
                const zip = new PizZip(content);
                const doc = new window.docxtemplater(zip, {
                    paragraphLoop: true,
                    linebreaks: true,
                });

                // 4. Renderizar (reemplazar etiquetas)
                doc.render(data);

                // 5. Generar el Blob para descarga
                const out = doc.getZip().generate({
                    type: "blob",
                    mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                });

                // 6. Guardar archivo
                const nombreArchivo = `Disposicion_${data.NUMERO_DNI}.docx`;
                saveAs(out, nombreArchivo);

            } catch (error) {
                console.error(error);
                alert("Error crÃ­tico: AsegÃºrate de que los archivos 'MODELO_3.docx' y 'MODELO_3_FIRMADO.docx' estÃ©n subidos en tu repositorio.");
            }
        }
    </script>
</body>
</html>
