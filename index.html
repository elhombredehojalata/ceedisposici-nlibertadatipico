function convertirDosajeALetras(num) {
    var valor = parseFloat(num);
    if (isNaN(valor)) return "";
    var partes = valor.toFixed(2).split('.');
    var enteros = parseInt(partes[0]);
    var decimales = parseInt(partes[1]);
    var unidades = ["cero", "un", "dos", "tres", "cuatro", "cinco", "seis", "siete", "ocho", "nueve"];
    var textoEnteros = enteros === 0 ? "cero" : unidades[enteros] || enteros;
    return textoEnteros + " gramos con " + decimales + " centigramos de alcohol por litro de sangre";
}

async function generarDocumento() {
    var resNum = document.getElementById('res_dosaje').value;
    var data = {
        NUMERO_DISPOSICION: document.getElementById('num_disp').value,
        FECHA_DISPOSICION: document.getElementById('fecha_disp').value,
        NOMBRE_IMPUTADO: document.getElementById('nombre').value.toUpperCase(),
        HECHOS: document.getElementById('hechos').value,
        FECHA_DE_HECHOS: document.getElementById('fecha_hechos').value,
        FECHA_DE_INTERVENCION_POLICIAL: document.getElementById('fecha_int').value,
        NUMER_DOSAJE: document.getElementById('num_dosaje').value,
        RESULTADO_DOSAJE: resNum + " G/L",
        RESULTADO_DOSAJE_LETRAS: convertirDosajeALetras(resNum),
        VEHICULO: document.getElementById('vehiculo').value.toUpperCase(),
        PLACA: document.getElementById('placa').value.toUpperCase()
    };

    try {
        var response = await fetch('MODELO_3.docx');
        if (!response.ok) throw new Error("Archivo no encontrado");
        var content = await response.arrayBuffer();
        var zip = new PizZip(content);
        var doc = new window.docxtemplater(zip, {paragraphLoop: true, linebreaks: true});
        doc.render(data);
        var out = doc.getZip().generate({type: "blob", mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document"});
        saveAs(out, "Libertad_" + data.NOMBRE_IMPUTADO + ".docx");
    } catch (error) {
        alert("Error: Revisa que MODELO_3.docx esté en GitHub y que todos los campos estén llenos.");
        console.log(error);
    }
}
